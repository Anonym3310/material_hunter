#!/system/bin/sh

USERINIT_SCRIPT_PATH=$(readlink -f $0)
sh ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bootkali_init
grep ' / ' /proc/mounts | grep -qv 'rootfs' || grep -q ' /system_root ' /proc/mounts && SYSTEM_IMAGE=/ || SYSTEM_IMAGE=/system
mount -o rw,remount $SYSTEM_IMAGE
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/chrootmgr /system/xbin/
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bootkali /system/xbin/
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bootkali_bash /system/xbin/
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bootkali_env /system/xbin/
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bootkali_init /system/xbin/
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bootkali_log /system/xbin/
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bootkali_login /system/xbin/
ln -sf ${USERINIT_SCRIPT_PATH%/*/*/*}/scripts/bin/busybox_nh /system/xbin/
mount -o ro,remount $SYSTEM_IMAGE